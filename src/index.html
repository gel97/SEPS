<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Seps</title>
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">

  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">


    <!-- Custom fonts for this template-->
    <link href="assets/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link
        href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
        rel="stylesheet">

    <!-- Custom styles for this template-->
    <link href="assets/css/sb-admin-2.min.css" rel="stylesheet">

    

</head>
<body id="page-top" class="sidebar-toggled">
  <!-- AIzaSyCKfcLWt_Z25xrX5x2lk-mx_CBQu5STlqE -->
<!-- AIzaSyBfQJlyD65DekS6HrSDe2z-6-KvoO4aeRk -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBfQJlyD65DekS6HrSDe2z-6-KvoO4aeRk" async defer 

  type="text/javascript"></script>
	<script type="text/javascript">
		var geocoder;
		var map;
		var lng;
		var lat;
		var address;
		var marker;
		var infowindow;

    
		function initialize() {
            console.log("loaded");
			geocoder = new google.maps.Geocoder();
			lng = document.getElementById("longtxt").value;
			lat = document.getElementById("lattxt").value;
			if (lng=="") {lng = 125.79577399999998;}  //default: central location
			if (lat=="") {lat = 7.388003000000015;}
			
			var latlng = new google.maps.LatLng(lat, lng);
			var myOptions = {
				zoom: 12,
				center: latlng,
				mapTypeId: google.maps.MapTypeId.ROADMAP
				}
			map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
			
				lng = document.getElementById("longtxt").value;
				lat = document.getElementById("lattxt").value;
				if ((lng!="") && (lat!="")) {
					//load markers directly if long-lat has already been defined
					address = document.getElementById("enme").value;
					latlng = new google.maps.LatLng(lat, lng);
					
					marker = new google.maps.Marker({
						position: latlng,
						draggable:true,
						//animation: google.maps.Animation.DROP,
						visible: true,
						title:address
						});
					marker.setMap(map);
					
					//event listeners  and info window for pre-defined location
					infowindow = new google.maps.InfoWindow({ content: '<small>'+address+'</small>', size: new google.maps.Size(60,20)});
					google.maps.event.addListener(marker, 'drag', function() { 
						updateMarkerPosition(this.getPosition()); 
					}); 
					google.maps.event.addListener(marker, 'dragend', function() { 
						updateMarkerPosition(this.getPosition()); 
						map.setCenter(this.getPosition())
					}); 
					google.maps.event.addListener(marker, 'click', function() {
						infowindow.open(map,marker);
					});
				}
					
				//else geocode the location for records without linitial ong-lat based on barangay
				if ((geocoder) && (lng=="")){
					address = document.getElementById("bgy").value;
					var infoaddr = document.getElementById("enme").value;
					geocoder.geocode( { 'address': address}, function(results, status) {
					
					if (status == google.maps.GeocoderStatus.OK) {
						if (status != google.maps.GeocoderStatus.ZERO_RESULTS) {
							map.setCenter(results[0].geometry.location);

						marker = new google.maps.Marker({
							position: results[0].geometry.location,
							map: map, 
							draggable:true,
							title:infoaddr
						}); 
						
						//event listeners and info window for successful geocoded location
						infowindow = new google.maps.InfoWindow({ content: '<small>'+infoaddr+'</small>', size: new google.maps.Size(60,20)});
						google.maps.event.addListener(marker, 'drag', function() { 
							updateMarkerPosition(this.getPosition()); 
						}); 
						google.maps.event.addListener(marker, 'dragend', function() { 
							updateMarkerPosition(this.getPosition()); 
							map.setCenter(this.getPosition())
						}); 
						google.maps.event.addListener(marker, 'click', function() {
							infowindow.open(map,marker);
						});
					  }
					  else {
						alert("No results found");
					  }
					} 
					else {
					  alert("Geocode was not successful for the following reason: " + status);
					}
				  });
				}
		}//end initialize google map
	
		function updateMarkerPosition(latlng) { 
			document.getElementById('lattxt').value=latlng.lat().toFixed(7); 
			document.getElementById('longtxt').value=latlng.lng().toFixed(7); 
		   }  
		
		function manualMarker(numval) {
			if (isNaN(numval)){
				  alert("Entered value is not a valid number.");
				}else {
				  initialize();
				}
			}
			
	</script>
  <app-root></app-root>

   <!-- Bootstrap core JavaScript-->
   <script src="assets/vendor/jquery/jquery.min.js"></script>
   <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

   <!-- Core plugin JavaScript-->
   <script src="assets/vendor/jquery-easing/jquery.easing.min.js"></script>

   <!-- Custom scripts for all pages-->
   <script src="assets/js/sb-admin-2.js"></script>

   <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
</body>
</html>
